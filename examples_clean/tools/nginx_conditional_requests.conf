# Обработка If-Modified-Since
location /products/ {
    # Включить 304 ответы
    if_modified_since exact;

    # Проксирование условных заголовков
    proxy_set_header If-Modified-Since
                     $http_if_modified_since;
    proxy_set_header If-None-Match
                     $http_if_none_match;

    # Кэшировать 304 ответы
    proxy_cache_valid 304 10m;

    # Отладочные заголовки
    add_header X-Cache-Status $upstream_cache_status;
    add_header X-Cache-Key $proxy_cache_key;
}