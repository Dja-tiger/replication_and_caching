# Защита от thundering herd для Техномира
location /hot-deals/ {
    proxy_cache technomir;

    # Микрокэш на 1 секунду
    proxy_cache_valid 200 1s;

    # Только один запрос к backend
    proxy_cache_lock on;
    proxy_cache_lock_timeout 5s;

    # Показать кэш пока обновляется
    proxy_cache_use_stale updating;
    proxy_cache_background_update on;

    # Добавить заголовок статуса кэша
    add_header X-Cache-Status $upstream_cache_status;

    proxy_pass http://backend;
}