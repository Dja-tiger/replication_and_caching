# Настройка кэша для upstream
proxy_cache_path /var/cache/nginx
    levels=1:2
    keys_zone=technomir:100m
    max_size=10g
    inactive=60m
    use_temp_path=off;

server {
    location /api/ {
        proxy_cache technomir;
        proxy_cache_key "$scheme$request_method$host$request_uri";

        # Кэшировать успешные ответы на 5 минут
        proxy_cache_valid 200 5m;
        proxy_cache_valid 404 1m;

        # Использовать устаревший кэш при ошибках
        proxy_cache_use_stale error timeout
                             updating http_500;
    }
}