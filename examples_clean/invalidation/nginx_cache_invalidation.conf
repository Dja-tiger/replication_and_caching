# Методы инвалидации для Техномира
location /cache/purge {
    # Доступ только для админов
    allow 10.0.0.0/8;
    deny all;

    # PURGE метод для очистки
    proxy_cache_purge technomir
        "$scheme$request_method$host$1";
}

# Автоматическая инвалидация при обновлении
location /api/products {
    if ($request_method = POST) {
        # Пометить кэш как устаревший
        add_header X-Accel-Expires 0;
    }

    proxy_cache_bypass $http_cache_control;
    proxy_no_cache $http_pragma $http_authorization;
}